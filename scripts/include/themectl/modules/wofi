#!/usr/bin/env bash

TC_WOFI="$TC_DIR/wofi"
WOFI_CONFIG_DIR="${WOFI_CONFIG_DIR:-$XDG_CONFIG_HOME/wofi}"

wofi_theme() {
    if [ ! -d "$WOFI_CONFIG_DIR" ]; then
        notify-warn "$FUNCNAME" "Rofi config directory not found. Ignoring."
        return
    fi
    local OUT_DIR="$WOFI_CONFIG_DIR/theme"
    local CSS_TMP="/tmp/theme_wofi/colors.css"
    local CSS_OUT="$OUT_DIR/colors.css"
    mkdir -p $(dirname "$CSS_TMP")
    clear_files "$CSS_TMP"
    [ ! -d "$OUT_DIR" ] && mkdir -p "$OUT_DIR"
    [ ! -d "$(dirname $CSS_TMP)" ] && mkdir -p "$(dirname $CSS_TMP)"
    local COLORS_CSS=
    if [ -f "$COLORS_JSON" ]; then
        colors_to_css "$COLORS_JSON" "$CSS_TMP" "no_header"
        COLORS_CSS=$(cat "$CSS_TMP")
    else
		notify-warn "$FUNCNAME" "$COLORS_JSON not found. Ignoring wofi colors."
    fi
    if ! [ -d "$TC_WOFI" ]; then
        notify-warn $FUNCNAME "Wofi config directory missing. Using defaults."
        TC_WOFI="$TC_SKELETON/wofi"
    fi
    for TC_FILE in "$TC_WOFI"/*; do
        local FILE_OUT="$OUT_DIR/$(basename $TC_FILE)"
        write_file_header "$FILE_OUT" "$TC_FILE" "${TC_FILE##*.}"
        awk -v repl="$COLORS_CSS" '
        {
            if ($0 == "{COLORS_CSS}") {
                print repl
            } else {
                print
            }
        }' "$TC_FILE" >> "$FILE_OUT"
    done
}

wofi_clean() {
    clear_dir "$WOFI_CONFIG_DIR/theme/"
    cp -r ${TC_SKELETON}/wofi/* "$WOFI_CONFIG_DIR/theme/"
}

wofi_reload() {
    echo "Nothing to do" > /dev/null
}

